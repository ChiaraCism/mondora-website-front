!function(){var e="v0.1.0b",t={dev:{host:"http://localhost:3000",endpoint:"ws://localhost:3000/websocket"},prod:{host:"http://api.nocheros.info",endpoint:"ws://api.nocheros.info/websocket"}};currentConfig=/b/.test(e)?t.dev:t.prod;var o={host:currentConfig.host,do_not_autocreate_collections:!0};o.ddpOptions={endpoint:currentConfig.endpoint,SocketConstructor:WebSocket,debug:!0},window.Ceres=new Asteroid(o)}(),angular.module("mnd.web",["ui.bootstrap","ui.router","mnd.sprinkle","mnd.dashboard","asteroid","angularFileUpload","ngSanitize"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"pages/home/home.html",controller:"HomeController",resolve:{homeConfig:function(){return Ceres.subscribe("configurations")}}}),e.state("postView",{url:"/post/:postId",templateUrl:"pages/post/view/postView.html",controller:"PostViewController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),e.state("postEdit",{url:"/post/:postId/edit",templateUrl:"pages/post/edit/postEdit.html",controller:"PostEditController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),e.state("postList",{url:"/posts",templateUrl:"pages/post/list/postList.html",controller:"PostListController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),t.otherwise("/")}]).run(["$rootScope",function(e){e.safeApply=function(t){var o=e.$$phase;"$apply"===o||"$digest"===o?"function"==typeof t&&t():this.$apply(t)},e.Ceres=Ceres,e.Ceres.subscribe("userProfileImage"),e.Configurations=Ceres.createCollection("configurations"),e.Posts=Ceres.createCollection("posts"),e.Users=Ceres.createCollection("users"),Ceres.on("login",function(){e.safeApply(function(){e.signedIn=!0,e.user=e.Users.findOne({})})}),Ceres.on("logout",function(){e.safeApply(function(){e.signedIn=!1})})}]).controller("MainController",["$scope",function(e){e.login=function(){e.Ceres.loginWithTwitter()},e.logout=function(){e.Ceres.logout()}}]),angular.module("mnd.web").controller("SidebarController",["$scope","$state",function(e,t){e.addPost=function(){var o={};e.Posts.insert(o),t.go("postEdit",{postId:o._id})},e.menu={items:[{title:"Home",href:"/"},{title:"Nuovo post",ngClick:"addPost"},{title:"cloud",href:"http://www.mondora.com"},{title:"governance",href:"http://www.mondora.com"},{title:"team",href:"http://www.mondora.com"},{title:"formazione",href:"http://www.mondora.com"},{title:"community",href:"http://www.mondora.com"},{title:"my mondora",type:"submenu",items:[{title:"pomodoro",href:"http://www.mondora.com"},{title:"AaS",href:"http://www.mondora.com"}]}]}}]),angular.module("mnd.web").factory("MndTagStrippingService",function(){return{strip:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent}}}),angular.module("mnd.web").controller("HomeController",["$scope","$collection","$sce",function(e,t,o){var r=e.Configurations.findOne({page:"home"});e.sprinkleText=r.sprinkleText,e.banner=r.banner,e.login=function(){e.Ceres.loginWithTwitter()};var n="http://download.mondora.s3.amazonaws.com/mondora.mp4";e.videoSource=o.trustAsResourceUrl(n)}]),angular.module("mnd.web").controller("PostEditController",["$scope","$interval","$stateParams","$upload",function(e,t,o,r){var n=o.postId;e.post=e.Posts.db.get(n),window.Posts=e.Posts;var s=document.getElementById("postTitleEditor");s.innerHTML=e.post.title||"";var i={placeholder:"Titolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(s,i);var l=document.getElementById("postSubtitleEditor");l.innerHTML=e.post.subtitle||"";var a={placeholder:"Sottotitolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(l,a);var u=document.getElementById("postBodyEditor");u.innerHTML=e.post.body||"";var p={placeholder:"Corpo",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(u,p),e.publishPost=function(){e.post.published=!0,e.save()},e.unpublishPost=function(){e.post.published=!1,e.save()},e.clickFileInput=function(){document.querySelector("#post-edit-image-upload input").click()},e.titleImageIsDisplayed=void 0!==e.post.titleImageSource,e.abortUpload=function(){e.uploadProgress=0,e.isUploading=!1,e.imageUpload.abort(),delete e.imageUpload},e.onFileSelect=function(t){var o=t[0];if(!/image/g.test(o.type))return void alert("Devi caricare un'immagine.");var n=Math.round(1e16*Math.random()),s=n+"__"+o.name,i={url:"https://ngtest.s3.amazonaws.com/",method:"POST",data:{key:s,acl:"public-read","Content-Type":o.type},file:o};e.isUploading=!0,e.imageUpload=r.upload(i).progress(function(t){e.uploadProgress=parseInt(100*t.loaded/t.total)}).success(function(){e.uploadProgress=100,e.isUploading=!1,e.post.titleImageSource="https://s3-eu-west-1.amazonaws.com/ngtest/"+s,e.titleImageIsDisplayed=!0,e.save()}).error(function(){})},e.save=function(){e.post.title=s.innerHTML,e.post.subtitle=l.innerHTML,e.post.body=u.innerHTML,e.post.user=e.user._id,e.post.authors=[{userId:e.user._id,name:e.user.profile.name,screenName:e.user.services.twitter.screenName,imageUrl:e.user.services.twitter.post_img_url}];var t=angular.copy(e.post);delete t._id,e.Posts.update(n,t)},t(e.save,5e3)}]),angular.module("mnd.web").controller("PostListController",["$timeout","$scope","$collection",function(e,t){e(function(){t.posts=t.Posts.db.itemsArray},500)}]),angular.module("mnd.web").controller("PostViewController",["$scope","$stateParams","MndTagStrippingService",function(e,t,o){var r=t.postId;e.post=e.Posts.db.get(r),e.titleImageIsDisplayed=void 0!==e.post.titleImageSource,e.sprinklePostText=o.strip(e.post.body),console.log(e.post)}]);