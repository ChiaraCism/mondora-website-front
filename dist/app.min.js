!function(){var t="v0.1.0b",e={dev:{host:"http://localhost:3000",endpoint:"ws://localhost:3000/websocket"},prod:{host:"http://api.nocheros.info",endpoint:"ws://api.nocheros.info/websocket"}};currentConfig=/b/.test(t)?e.dev:e.prod;var o={host:currentConfig.host,do_not_autocreate_collections:!0};o.ddpOptions={endpoint:currentConfig.endpoint,SocketConstructor:WebSocket},window.Ceres=new Asteroid(o)}(),angular.module("mnd.web",["ui.bootstrap","ui.router","mnd.sprinkle","mnd.dashboard","asteroid","angularFileUpload","ngSanitize"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("home",{url:"/",templateUrl:"pages/home/home.html",controller:"HomeController",resolve:{homeConfig:function(){return Ceres.subscribe("configurations")}}}),t.state("postView",{url:"/post/:postId",templateUrl:"pages/post/view/postView.html",controller:"PostViewController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),t.state("postEdit",{url:"/post/:postId/edit",templateUrl:"pages/post/edit/postEdit.html",controller:"PostEditController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),t.state("postList",{url:"/posts",templateUrl:"pages/post/list/postList.html",controller:"PostListController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),e.otherwise("/")}]).run(["$rootScope",function(t){t.safeApply=function(e){var o=t.$$phase;"$apply"===o||"$digest"===o?"function"==typeof e&&e():this.$apply(e)},t.Ceres=Ceres,t.Ceres.subscribe("userProfileImage"),t.Configurations=Ceres.createCollection("configurations"),t.Posts=Ceres.createCollection("posts"),t.Users=Ceres.createCollection("users"),Ceres.on("login",function(){t.safeApply(function(){t.signedIn=!0,t.user=t.Users.findOne({})})}),Ceres.on("logout",function(){t.safeApply(function(){t.signedIn=!1})})}]).controller("MainController",["$scope",function(t){t.login=function(){t.Ceres.loginWithTwitter()},t.logout=function(){t.Ceres.logout()}}]),angular.module("mnd.web").controller("SidebarController",["$scope","$state",function(t,e){t.addPost=function(){var o={};t.Posts.insert(o),e.go("postEdit",{postId:o._id})},t.menu={items:[{title:"Home",href:"/"},{title:"Nuovo post",ngClick:"addPost"},{title:"Cloud",href:"http://www.mondora.com"},{title:"Governance",href:"http://www.mondora.com"},{title:"Team",href:"http://www.mondora.com"},{title:"Formazione",href:"http://www.mondora.com"},{title:"Community",href:"http://www.mondora.com"},{title:"My mondora",type:"submenu",items:[{title:"Pomodoro",href:"http://www.mondora.com"},{title:"AaS",href:"http://www.mondora.com"}]}]}}]),angular.module("mnd.web").factory("MndTagStrippingService",function(){return{strip:function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent}}}),angular.module("mnd.web").controller("HomeController",["$scope","$collection","$sce",function(t,e,o){var n=t.Configurations.findOne({page:"home"});t.sprinkleText=n.sprinkleText,t.banner=n.banner,t.login=function(){t.Ceres.loginWithTwitter()};var r="http://mnd-website.s3.amazonaws.com/Mnd-Alps.mp4";t.videoSource=o.trustAsResourceUrl(r);var s="http://s3.amazonaws.com/mnd-website/vd-back.jpg";t.videoPoster=o.trustAsResourceUrl(s)}]),angular.module("mnd.web").controller("PostEditController",["$scope","$interval","$state","$stateParams","$upload",function(t,e,o,n,r){var s=n.postId;t.post=t.Posts.db.get(s),window.Posts=t.Posts;var i=document.getElementById("postTitleEditor");i.innerHTML=t.post.title||"";var a={placeholder:"Titolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(i,a);var l=document.getElementById("postSubtitleEditor");l.innerHTML=t.post.subtitle||"";var u={placeholder:"Sottotitolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(l,u);var c=document.getElementById("postBodyEditor");c.innerHTML=t.post.body||"";var p={placeholder:"Corpo",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(c,p),t.toggleDelete=function(){t.showDelete=!t.showDelete},t.deletePost=function(){t.Posts.remove(s),o.go("home")},t.publishPost=function(){t.post.published=!0,t.save()},t.unpublishPost=function(){t.post.published=!1,t.save()},t.isOwner=function(){return t.user&&t.post.user===t.user._id},t.clickFileInput=function(){document.querySelector("#post-edit-image-upload input").click()},t.titleImageIsDisplayed=void 0!==t.post.titleImageSource,t.abortUpload=function(){t.uploadProgress=0,t.isUploading=!1,t.imageUpload.abort(),delete t.imageUpload},t.onFileSelect=function(e){var o=e[0];if(!/image/g.test(o.type))return void alert("Devi caricare un'immagine.");var n=Math.round(1e16*Math.random()),s=n+"__"+o.name,i={url:"https://ngtest.s3.amazonaws.com/",method:"POST",data:{key:s,acl:"public-read","Content-Type":o.type},file:o};t.isUploading=!0,t.imageUpload=r.upload(i).progress(function(e){t.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(){t.uploadProgress=100,t.isUploading=!1,t.post.titleImageSource="https://s3-eu-west-1.amazonaws.com/ngtest/"+s,t.titleImageIsDisplayed=!0,t.save()}).error(function(){})},t.save=function(){t.post.title=i.innerHTML,t.post.subtitle=l.innerHTML,t.post.body=c.innerHTML,t.post.user=t.user._id,t.post.comments=[],t.post.authors=[{userId:t.user._id,name:t.user.profile.name,screenName:t.user.services.twitter.screenName,imageUrl:t.user.services.twitter.profile_image_url}];var e=angular.copy(t.post);delete e._id,t.Posts.update(s,e)};var d=e(t.save,5e3);t.$on("$destroy",function(){e.cancel(d)})}]),angular.module("mnd.web").controller("PostListController",["$timeout","$scope","$collection",function(t,e){t(function(){e.posts=e.Posts.db.itemsArray},500)}]),angular.module("mnd.web").factory("FirstLevelHtmlParser",function(){var t=function(t){var e=document.createElement("div");return e.innerHTML=t,Array.prototype.map.call(e.children,function(t){return t.outerHTML})};return{parse:t}}).directive("readonlyEditor",function(){var t=function(t){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML='<i class="fa fa-twitter"></i>',this.button.target="_blank",this.button.onclick=function(){var e="https://twitter.com/intent/tweet?text=",o='"'+window.getSelection().toString()+'" - @';o+=t+" "+window.location.href;var n=e+o,r=window.open(n,"popup","height=420,width=550");r.focus||r.focus()}};return t.prototype.getButton=function(){return this.button},{link:function(e,o){var n={disableEditing:!0,buttons:["tweet"],extensions:{tweet:new t}};o[0].innerHTML=e.child,new MediumEditor(o[0],n)}}}).filter("filterCommentsByParagraph",function(){return function(t,e){var o=[];return t.forEach(function(t){t.paragraph===e&&o.push(t)}),o}}).controller("PostViewController",["$scope","$stateParams","MndTagStrippingService","FirstLevelHtmlParser",function(t,e,o,n){var r=e.postId;t.post=t.Posts.db.get(r),t.bodyChildren=n.parse(t.post.body),t.titleImageIsDisplayed=void 0!==t.post.titleImageSource,t.sprinklePostText=o.strip(t.post.body),t.isAuthor=function(){var e=!1;return t.user&&t.post.authors.forEach(function(o){o.userId===t.user._id&&(e=!0)}),e},t.commentBarStatus=[],t.closeCommentBar=function(){t.commentBarIsOpen=!1,t.commentBarStatus=[]},t.openCommentBarAt=function(e){t.commentBarIsOpen=!0,t.commentBarStatus[e]=!0},t.commentBarIsOpenAt=function(e){return t.commentBarStatus[e]},t.deleteComment=function(e){var o=t.Ceres.call("deleteCommentFromPost",r,e._id);o.updated.then(function(){t.post=t.Posts.db.get(r),t.$apply()})},t.publishComment=function(e){var o=t.Ceres.call("publishCommentOfPost",r,e._id);o.updated.then(function(){t.post=t.Posts.db.get(r),t.$apply()})},t.ownsComment=function(e){return t.user?e.user._id===t.user._id:void 0},t.comment={},t.paragraphHasComments=function(e){var o=[];return t.post.comments.forEach(function(t){t.paragraph===e&&o.push(t)}),o.length>0},t.paragraphCommentsLength=function(e){var o=[];return t.post.comments.forEach(function(t){t.paragraph===e&&o.push(t)}),o.length},t.saveCommentAt=function(e){var o=function(){for(var t="",e=0;8>e;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t};t.comment._id=o(),t.comment.user={_id:t.user._id,screenName:t.user.services.twitter.screenName,profile_image_url:t.user.services.twitter.profile_image_url},t.comment.paragraph=e;var n=t.Ceres.call("addCommentToPost",r,t.comment);n.updated.then(function(){t.post=t.Posts.db.get(r),t.$apply()}),t.comment.text=""}}]);