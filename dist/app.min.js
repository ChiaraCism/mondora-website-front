!function(){var o={host:"http://api.nocheros.info",do_not_autocreate_collections:!0};o.ddpOptions={endpoint:"ws://api.nocheros.info/websocket",SocketConstructor:WebSocket,debug:!0},window.Ceres=new Asteroid(o)}(),angular.module("mnd.web",["ui.bootstrap","ui.router","mnd.sprinkle","mnd.dashboard","asteroid","angularFileUpload","ngSanitize"]).config(["$stateProvider","$urlRouterProvider",function(o,e){o.state("home",{url:"/",templateUrl:"pages/home/home.html",controller:"HomeController",resolve:{homeConfig:function(){return Ceres.subscribe("configurations")}}}),o.state("postView",{url:"/post/:postId",templateUrl:"pages/post/view/postView.html",controller:"PostViewController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),o.state("postEdit",{url:"/post/:postId/edit",templateUrl:"pages/post/edit/postEdit.html",controller:"PostEditController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),o.state("postList",{url:"/posts",templateUrl:"pages/post/list/postList.html",controller:"PostListController",resolve:{postSub:function(){return Ceres.subscribe("posts")}}}),e.otherwise("/")}]).run(["$rootScope",function(o){o.safeApply=function(e){var t=o.$$phase;"$apply"===t||"$digest"===t?"function"==typeof e&&e():this.$apply(e)},o.Ceres=Ceres,o.Ceres.subscribe("userProfileImage"),o.Configurations=Ceres.createCollection("configurations"),o.Posts=Ceres.createCollection("posts"),o.Users=Ceres.createCollection("users"),Ceres.on("login",function(){o.safeApply(function(){o.signedIn=!0,o.user=o.Users.findOne({})})}),Ceres.on("logout",function(){o.safeApply(function(){o.signedIn=!1})})}]).controller("MainController",["$scope",function(o){o.login=function(){o.Ceres.loginWithTwitter()},o.logout=function(){o.Ceres.logout()}}]),angular.module("mnd.web").controller("SidebarController",["$scope","$state",function(o,e){o.addPost=function(){var t={};o.Posts.insert(t),e.go("postEdit",{postId:t._id})},o.menu={items:[{title:"Home",href:"/"},{title:"Nuovo post",ngClick:"addPost"},{title:"cloud",href:"http://www.mondora.com"},{title:"governance",href:"http://www.mondora.com"},{title:"team",href:"http://www.mondora.com"},{title:"formazione",href:"http://www.mondora.com"},{title:"community",href:"http://www.mondora.com"},{title:"my mondora",type:"submenu",items:[{title:"pomodoro",href:"http://www.mondora.com"},{title:"AaS",href:"http://www.mondora.com"}]}]}}]),angular.module("mnd.web").controller("HomeController",["$scope","$collection","$sce",function(o,e,t){var n=o.Configurations.findOne({page:"home"});o.sprinkleText=n.sprinkleText,o.banner=n.banner,o.login=function(){o.Ceres.loginWithTwitter()};var r="http://download.mondora.s3.amazonaws.com/mondora.mp4";o.videoSource=t.trustAsResourceUrl(r)}]),angular.module("mnd.web").controller("PostEditController",["$scope","$interval","$stateParams","$upload",function(o,e,t,n){var r=t.postId;o.post=o.Posts.db.get(r),window.Posts=o.Posts;var s=document.getElementById("postTitleEditor");s.innerHTML=o.post.title||"";var i={placeholder:"Titolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(s,i);var l=document.getElementById("postSubtitleEditor");l.innerHTML=o.post.subtitle||"";var a={placeholder:"Sottotitolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(l,a);var u=document.getElementById("postBodyEditor");u.innerHTML=o.post.body||"";var d={placeholder:"Corpo",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(u,d),o.publishPost=function(){o.post.published=!0,o.save()},o.unpublishPost=function(){o.post.published=!1,o.save()},o.clickFileInput=function(){document.querySelector("#post-edit-image-upload input").click()},o.titleImageIsDisplayed=void 0!==o.post.titleImageSource,o.abortUpload=function(){o.uploadProgress=0,o.isUploading=!1,o.imageUpload.abort(),delete o.imageUpload},o.onFileSelect=function(e){var t=e[0];if(!/image/g.test(t.type))return void alert("Devi caricare un'immagine.");var r=Math.round(1e16*Math.random()),s=r+"__"+t.name,i={url:"https://ngtest.s3.amazonaws.com/",method:"POST",data:{key:s,acl:"public-read","Content-Type":t.type},file:t};o.isUploading=!0,o.imageUpload=n.upload(i).progress(function(e){o.uploadProgress=parseInt(100*e.loaded/e.total)}).success(function(){o.uploadProgress=100,o.isUploading=!1,o.post.titleImageSource="https://s3-eu-west-1.amazonaws.com/ngtest/"+s,o.titleImageIsDisplayed=!0,o.save()}).error(function(){})},o.save=function(){o.post.title=s.innerHTML,o.post.subtitle=l.innerHTML,o.post.body=u.innerHTML;var e=angular.copy(o.post);delete e._id,o.Posts.update(r,e)},e(o.save,5e3)}]),angular.module("mnd.web").controller("PostListController",["$timeout","$scope","$collection",function(o,e){o(function(){e.posts=e.Posts.db.itemsArray},500)}]),angular.module("mnd.web").controller("PostViewController",["$scope","$stateParams",function(o,e){var t=e.postId;o.post=o.Posts.db.get(t)}]);