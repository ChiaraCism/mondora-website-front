<div class="post-title-image">
	<img ng-src="{{post.titleImageUrl}}" ng-if="titleImageIsDisplayed()" alt="Immagine principale" />
	<div class="post-overlay" ng-if="titleImageIsDisplayed()"/></div>
</div>

<div ng-if="isAuthor()" class="post-top-buttons">
	<a ui-sref="postEdit({postId: post._id})" class="btn btn-default">Modifica</a>
</div>

<div id="mnd-post-sprinkle-container">
	<div mnd-sprinkle text="{{sprinklePostText()}}"></div>
	<div class="pull-right read-time">Reading time {{estimateReadingTime()}} min</div>
</div>

<div class="mnd-mind-container">
	<div mnd-mind-map map="post.map" mnd-center></div>
</div>

<div class="post-header">
	<div class="col-sm-8 col-sm-offset-2">
		<h1 ng-bind-html="post.title" class="post-title" ng-class="{'color-me-white': titleImageIsDisplayed()}"></h1>
		<h2 ng-bind-html="post.subtitle" class="post-subtitle" ng-class="{'color-me-white': titleImageIsDisplayed()}"></h2>
		<div class="post-author" ng-repeat="author in post.authors">
			<img class="img-circle" ng-src="{{author.imageUrl}}" />
			&nbsp;&nbsp;Author {{author.screenName}}
		</div>
	</div>
</div>

<div class="post-scroll-to-content" ng-show="isMobile"><i class="fa fa-chevron-down"></i></div>

<div class="post-body">
	<div class="first-level-html-container" ng-repeat="child in bodyChildren() track by $index">
		<div class="col-sm-8" ng-class="{'col-sm-offset-2': !commentBarIsOpen, 'col-sm-offset-1': commentBarIsOpen}">
			<div class="simplebox" readonly-editor data-disable-editing></div>
		</div>
		<div class="col-sm-2" ng-class="{hidden: commentBarIsOpen}">
			<i class="fa fa-comment comment-bubble" ng-if="!paragraphHasComments($index)" ng-click="openCommentBarAt($index)"></i>
			<span class="badge comment-badge" ng-if="paragraphHasComments($index)" ng-click="openCommentBarAt($index)">{{paragraphCommentsLength($index)}}</span>
		</div>
		<div class="col-sm-3" ng-class="{hidden: !commentBarIsOpen}">
			<div class="side-comment-container" ng-class="{hidden: !commentBarIsOpenAt($index)}">
				<div class="col-sm-12">
					<i class="fa fa-comment comment-bubble-always-visible" ng-click="closeCommentBar()"></i>
				</div>

				<div class="col-sm-2" ng-if="isAuthor()" ng-repeat-start="comment in post.comments | filterCommentsByParagraph:$index">
					<img class="img-circle" ng-src="{{comment.userPictureUrl}}" width="32" />
				</div>
				<div class="col-sm-10" ng-if="isAuthor()" ng-repeat-end>
                    <p>
                        <b>{{comment.userScreenName}}</b>
                        {{comment.text}}
                    </p>
                    <a class="mnd-clickable" ng-if="ownsComment(comment)" ng-click="deleteComment(comment)">Elimina</a>
                    <a class="mnd-clickable" ng-if="!comment.approved" ng-click="publishComment(comment)">Rendi pubblico</a>
					<hr />
				</div>

				<div class="col-sm-2" ng-if="!isAuthor()" ng-repeat-start="comment in post.comments | filterCommentsByParagraph:$index | filterCommentsByApprovalStatus:user._id">
					<img class="img-circle" ng-src="{{comment.userPictureUrl}}" width="32" />
				</div>
				<div class="col-sm-10" ng-if="!isAuthor()" ng-repeat-end>
                    <p>
                        <b>{{comment.userScreenName}}</b>
                        {{comment.text}}
                    </p>
                    <a class="mnd-clickable" ng-if="ownsComment(comment)" ng-click="deleteComment(comment)">Elimina</a>
					<hr />
				</div>

				<div class="col-sm-2">
					<img class="img-circle" ng-src="{{user.twitterProfile.pictureUrl}}" width="32" />
				</div>
				<div class="col-sm-10">
					<p><b>{{user.twitterProfile.screenName}}</b></p>
					<textarea ng-model="comment.text" class="form-control" placeholder="Lascia un commento" rows="1"></textarea>
                    <a class="mnd-clickable" ng-click="saveCommentAt($index)">Salva</a>
					<hr />
					<p>
						Questo commento Ã¨ solo visibile da te e dall'autore,
						a meno che l'autore decida di renderlo pubblico
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="post-body-bottom-spacer"></div>
</div>
